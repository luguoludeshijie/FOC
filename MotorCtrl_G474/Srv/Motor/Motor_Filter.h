/*******************************************************************************
*
* 文件名称: Motor_Filter.h
* 版 本 号: V1.0 
* 作    者: linbo.liu
* 生成日期: 2024年x月x日
* 功能描述: 
*
*******************************************************************************/
#ifndef _MOTOR_FILTER_H_
#define _MOTOR_FILTER_H_


/*******************************************************************************
 *-----------------------------------头文件-------------------------------------
 ******************************************************************************/
#include "App.h"


/*******************************************************************************
 *-----------------------------------宏定义-------------------------------------
 ******************************************************************************/
 #define MOVE_FILTER_BUF_MAXSIZE     500    


/*******************************************************************************
 *---------------------------------数据类型定义----------------------------------
 ******************************************************************************/
typedef struct{
    int32_t  buf[MOVE_FILTER_BUF_MAXSIZE];
    int32_t  buf_sum;
    uint32_t buf_size; 
    uint32_t buf_Index;
    uint32_t buf_fill;
    float val;                                  /*计算的平均值*/
}MOVE_FILTER_T;

typedef struct{
    float 	Kp;										/*锁相环PI控制器Kp*/
    float 	Ki;										/*锁相环PI控制器Ki*/

    float   P;
    float   I;

    float   Err;
    float 	Angle_Err;						        /*角度误差*/
    float 	Angle_Err_last;				            /*上一次角度误差*/
    float 	Omega;								    /*电角速度*/
    float 	Omega_F;							    /*滤波后的电角速度*/
    float 	Angle;								    /*锁相环计算得到的电角度*/


    float 	Angle_last;						        /*上一次的电角度*/

    float   Ts;                                       /*执行周期*/

    MOVE_FILTER_T move_filter;
}PLL_T;  



/*******************************************************************************
 *-----------------------------------常量定义------------------------------------
 ******************************************************************************/


/*******************************************************************************
 *-----------------------——--------全局变量定义----------------------------------
 ******************************************************************************/


/*******************************************************************************
 *-----------------------------------函数接口------------------------------------
 ******************************************************************************/

  
extern void Move_Filter_Init(MOVE_FILTER_T *filter, uint32_t buf_size);
extern void Move_Filter_fill(MOVE_FILTER_T *filter, int64_t val);
extern void Move_Filter_Clear(MOVE_FILTER_T *filter);
extern float Move_Filter_calculate(MOVE_FILTER_T *filter);

// void PLL_Init(PLL_t *pll, float Ts);
// void PLL_Cale(PLL_t *pll, float alpha, float beta);
// void PLL_Cale_SMO(PLL_t *pll, float alpha, float beta);
// void PLL_Calc_HALL(PLL_t *pll, float input_theta, float input_speed);


// void PLL_Cale_HFI(PLL_t *pll, float alpha, float beta);

// void PLL_Clear(PLL_t *pll);

/*******************************************************************************
 *---------------------------—----—--变量接口------------------------------------
 ******************************************************************************/


#endif
/*******************************************************************************
 *---------------------------—----—---结束--------------------------------------
 ******************************************************************************/